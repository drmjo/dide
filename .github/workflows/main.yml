name: Build All

on: [push]

jobs:
  helm:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: "3.8.0"
      env:
        SHA256SUM: 8408c91e846c5b9ba15eb6b1a5a79fc22dd4d33ac6ea63388e5698d1b2320c8b
        VERSION:  "3.8.0"
        APP: helm
      run: bash build.sh

  terragrunt:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 0.42.7
      env:
        SHA256SUM: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
        VERSION: 0.42.7
        APP: terragrunt
      run: bash build.sh

  kubectl:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.26.1
      env:
        SHA256SUM: d57be22cfa25f7427cfb538cfc8853d763878f8b36c76ce93830f6f2d67c6e5d
        VERSION: 1.26.1
        APP: kubectl
      run: bash build.sh

    - name: 1.25.6
      env:
        SHA256SUM: ba876aef0e9d7e2e8fedac036ec194de5ec9b6d2953e30ff82a2758c6ba32174
        VERSION: 1.25.6
        APP: kubectl
      run: bash build.sh

    - name: 1.24.10
      env:
        SHA256SUM: d8e9cd9bb073ff09e2f2a74cf48e94a9b9d4f2fa2e2dd91b68b01f64e7061a3b
        VERSION: 1.24.10
        APP: kubectl
      run: bash build.sh

    - name: 1.23.16
      env:
        SHA256SUM: 5f914edc9dbfbe1b8b8dc0f5dbbac28720a8dffeb940e3339c371e3612c37e48
        VERSION: 1.23.16
        APP: kubectl
      run: bash build.sh

    - name: 1.22.17
      env:
        SHA256SUM: 7506a0ae7a59b35089853e1da2b0b9ac0258c5309ea3d165c3412904a9051d48
        VERSION: 1.22.17
        APP: kubectl
      run: bash build.sh

  awscli:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 2.9.13
      env:
        VERSION: 2.9.13
        # empty shasum
        SHA256SUM: 2a9a88327cd01f17dcf0b19cdbe060242d1aff12b8aed4e01162cb74270d9b85
        APP: awscli
      run: bash build.sh
  eks:
    needs:
    - awscli
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.26
      env:
        VERSION: 1.26
        APP: eks
      run: bash build.sh
    - name: 1.25
      env:
        VERSION: 1.25
        APP: eks
      run: bash build.sh
    - name: 1.24
      env:
        VERSION: 1.24
        APP: eks
      run: bash build.sh
    - name: 1.23
      env:
        VERSION: 1.23
        APP: eks
      run: bash build.sh
    - name: 1.22
      env:
        VERSION: 1.22
        APP: eks
      run: bash build.sh

  base:
    needs:
    - awscli
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: base
      env:
        # this version should be the aws cli version
        VERSION: 2.9
        APP: base
      run: bash build.sh
  ide:
    needs:
    - base
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.26
      env:
        VERSION: 1.26
        APP: ide
      run: bash build.sh
    - name: 1.25
      env:
        VERSION: 1.25
        APP: ide
      run: bash build.sh
    - name: 1.24
      env:
        VERSION: 1.24
        APP: ide
      run: bash build.sh
    - name: 1.23
      env:
        VERSION: 1.23
        APP: ide
      run: bash build.sh
    - name: 1.22
      env:
        VERSION: 1.22
        APP: ide
      run: bash build.sh
