name: Build All

on: [push]

jobs:
  helm:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: "3.8.0"
      env:
        SHA256SUM: 8408c91e846c5b9ba15eb6b1a5a79fc22dd4d33ac6ea63388e5698d1b2320c8b
        VERSION:  "3.8.0"
        APP: helm
      run: bash build.sh

  terragrunt:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 0.38.6
      env:
        SHA256SUM: 2fef737ade1393acd744dcacbf4a6191374499ca0499b85c795d7a4abd2c1483
        VERSION: 0.38.6
        APP: terragrunt
      run: bash build.sh

  kubectl:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.23.4
      env:
        SHA256SUM: 3f0398d4c8a5ff633e09abd0764ed3b9091fafbe3044970108794b02731c72d6
        VERSION: 1.23.4
        APP: kubectl
      run: bash build.sh
    - name: 1.22.7
      env:
        SHA256SUM: 4dd14c5b61f112b73a5c9c844011a7887c4ffd6b91167ca76b67197dee54d388
        VERSION: 1.22.7
        APP: kubectl
      run: bash build.sh
    - name: 1.21.10
      env:
        SHA256SUM: 24ce60269b1ffe1ca151af8bfd3905c2427ebef620bc9286484121adf29131c0
        VERSION: 1.21.10
        APP: kubectl
      run: bash build.sh
    - name: "1.20.15"
      env:
        SHA256SUM: d283552d3ef3b0fd47c08953414e1e73897a1b3f88c8a520bb2e7de4e37e96f3
        VERSION: "1.20.15"
        APP: kubectl
      run: bash build.sh

  awscli:
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 2.4.22
      env:
        VERSION: 2.4.22
        # empty shasum
        SHA256SUM: 30b833aeb05a122aa05c7d508cb80d1ea08292249846091f4a1744b4c197a615
        APP: awscli
      run: bash build.sh
  eks:
    needs:
    - awscli
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.23
      env:
        VERSION: 1.23
        APP: eks
      run: bash build.sh
    - name: 1.22
      env:
        VERSION: 1.22
        APP: eks
      run: bash build.sh
    - name: 1.21
      env:
        VERSION: 1.21
        APP: eks
      run: bash build.sh
    - name: "1.20"
      env:
        VERSION: "1.20"
        APP: eks
      run: bash build.sh

  base:
    needs:
    - awscli
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: base
      env:
        # this version should be the aws cli version
        VERSION: 2.4
        APP: base
      run: bash build.sh
  ide:
    needs:
    - base
    runs-on: ubuntu-latest
    steps:
    - name: Git checkout
      uses: actions/checkout@v1
    - name: Login
      run: |
        echo ${{ secrets.DOCKERHUB_PASSWORD }} | \
          docker login -u drmjo --password-stdin
    - name: 1.23
      env:
        VERSION: 1.23
        APP: ide
      run: bash build.sh
    - name: 1.22
      env:
        VERSION: 1.22
        APP: ide
      run: bash build.sh
    - name: 1.21
      env:
        VERSION: 1.21
        APP: ide
      run: bash build.sh
    - name: "1.20"
      env:
        VERSION: "1.20"
        APP: ide
      run: bash build.sh